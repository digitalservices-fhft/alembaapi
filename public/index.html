<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Digital Services : Report an issues</title>
  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap5.3.3/dist/css/bootstrap.min.css"</script>
  <script src="https://ajax.googleapis.com/ajax3.7.1/jquery.min.js"</script>
</head>
<body class="container py-5">
  <img src="img/FHFT_DS_Text_Logo_Trans_300x48.png">
  <h1 class="mb-4">Submit a Ticket</h1>
  <form id="ticketForm">
    <div class="mb-3">
      <label for="ReceivingGroup" class="form-label">Receiving Group</label>
      <input type="number" class="form-control" id="ReceivingGroup" required />
    </div>
    <div class="mb-3">
      <label for="CustomString1" class="form-label">Custom String</label>
      <input type="text" class="form-control" id="CustomString1" required />
    </div>
    <div class="mb-3">
      <label for="ConfigurationItemId" class="form-label">Configuration Item ID</label>
      <input type="number" class="form-control" id="ConfigurationItemId" required />
    </div>
    <button type="submit" class="btn btn-primary" id="submitBtn">Submit Ticket</button>
  </form>
  <div id="message" class="mt-4"></div>

  <script>
    let authToken = null;

    $(document).ready(function () {
      // Fetch token on load
      $.get('/api/get-token', function (data) {
        authToken = data.token;
      });

      // Handle form submission
      $('#ticketForm').on('submit', function (e) {
        e.preventDefault();
        const ReceivingGroup = $('#ReceivingGroup').val();
        const CustomString1 = $('#CustomString1').val();
        const ConfigurationItemId = $('#ConfigurationItemId').val();

        $.ajax({
          url: '/api/submit-ticket',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ ReceivingGroup, CustomString1, ConfigurationItemId }),
          success: function (response) {
            $('#message').html(
              `<div class="alert alert-success">Thank you for logging the issue. Ticket "<strong>${response.ref}</strong>" has been logged.</div>`
            );
            $('#submitBtn').hide();
          },
          error: function () {
            $('#message').html(
              '<div class="alert alert-danger">There was an error submitting the ticket.</div>'
            );
          }
        });
      });
    });
  </script>
</body>
</html>
